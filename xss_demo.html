<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS æ”»æ“ŠåŸç†èˆ‡é˜²ç¦¦å¯¦æ¸¬</title>
    <style>
        :root { --bg: #f0f2f5; --card: #fff; --primary: #007bff; --danger: #dc3545; --success: #28a745; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; background: var(--bg); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        .container { background: var(--card); padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 800px; position: relative; }
        h1 { text-align: center; color: #333; margin-bottom: 10px; }
        p { text-align: center; color: #666; margin-bottom: 20px; }

        /* Navigation */
        .nav-btn { position: absolute; top: 20px; left: -140px; text-decoration: none; background: #333; color: white; padding: 8px 15px; border-radius: 4px; font-size: 14px; }
        .nav-btn:hover { background: #555; }
        @media (max-width: 1000px) { .nav-btn { position: static; display: block; margin-bottom: 15px; width: fit-content; } }

        /* Security Switch */
        .mode-switch { margin-bottom: 20px; padding: 15px; background: #fff3cd; border: 1px solid #ffeeba; border-radius: 8px; text-align: center; transition: all 0.3s; }
        .mode-switch.secure { background: #d4edda; border-color: #c3e6cb; }
        .switch-btn { margin-top: 10px; padding: 8px 16px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        
        /* Input Area */
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
        .btn-submit { background: var(--primary); color: white; border: none; padding: 0 25px; border-radius: 6px; cursor: pointer; font-size: 16px; }
        .btn-submit:hover { background: #0056b3; }

        /* Payload Grid */
        .payload-area { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef; margin-bottom: 20px; }
        .payload-title { font-size: 14px; font-weight: bold; color: #555; margin-bottom: 10px; display: block; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 8px; }
        .test-btn { padding: 6px 10px; font-size: 12px; border: 1px solid #ccc; background: white; border-radius: 4px; cursor: pointer; text-align: left; transition: 0.2s; }
        .test-btn:hover { background: #e2e6ea; border-color: #adb5bd; }
        .test-btn:active { transform: scale(0.98); }
        .category-alert { border-left: 3px solid #e83e8c; }
        .category-deface { border-left: 3px solid #fd7e14; }
        .category-steal { border-left: 3px solid #dc3545; }
        .category-style { border-left: 3px solid #6610f2; }

        /* Comments */
        .comments-section { border-top: 2px solid #eee; margin-top: 20px; padding-top: 10px; min-height: 100px; }
        .comment { background: #fff; padding: 15px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #e0e0e0; border-left: 5px solid var(--primary); word-break: break-all; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .comment-meta { font-size: 12px; color: #999; margin-bottom: 5px; }

        /* Hacked Styles (for demo) */
        .hacked-bg { background-color: black !important; color: lime !important; }
        .hacked-title { font-family: "Courier New", monospace; text-align: center; color: red; font-size: 30px; font-weight: bold; background: black; padding: 20px; }
        .fake-login { border: 2px dashed red; padding: 10px; background: #fff0f0; margin: 10px 0; }
    </style>
</head>
<body>

    <div class="container">
        <a href="csrf_demo.html" class="nav-btn">â¬… å›åˆ° CSRF æ¼”ç¤º</a>
        <h1>XSS æ¼æ´å¯¦æ¸¬å¯¦é©—å®¤</h1>
        <p>æ¸¬è©¦ç¶²ç«™æ˜¯å¦æ­£ç¢ºéæ¿¾äº†ä½¿ç”¨è€…çš„æƒ¡æ„è¼¸å…¥</p>

        <div id="securityPanel" class="mode-switch">
            ç•¶å‰ç‹€æ…‹ï¼š<strong style="color: #dc3545; font-size: 1.2em;">ğŸ”“ å±éšª (Raw HTML)</strong><br>
            <small>ç¶²ç«™ç›´æ¥ä½¿ç”¨ <code>innerHTML</code> æ¸²æŸ“å…§å®¹ï¼Œä¸é€²è¡Œä»»ä½•éæ¿¾ã€‚</small><br>
            <button onclick="toggleSecurity()" class="switch-btn" style="background:#dc3545; color: white;">åˆ‡æ›ç‚ºå®‰å…¨æ¨¡å¼</button>
        </div>

        <div class="input-group">
            <input type="text" id="userInput" placeholder="åœ¨æ­¤è¼¸å…¥ç•™è¨€æˆ–æ˜¯é»æ“Šä¸‹æ–¹æ¸¬è©¦è…³æœ¬..." autocomplete="off">
            <button onclick="postComment()" class="btn-submit">é€å‡º</button>
        </div>

        <div class="payload-area">
            <span class="payload-title">â–¼ é»æ“Šè¼‰å…¥æ”»æ“Š Payload (å…± 15 ç¨®)</span>
            <div class="grid" id="buttonGrid">
                </div>
            <div style="margin-top:10px; text-align: right;">
                <button onclick="clearComments()" style="font-size:12px; cursor:pointer; padding:5px 10px;">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰ç•™è¨€</button>
            </div>
        </div>

        <h3>ç•™è¨€åˆ—è¡¨ï¼š</h3>
        <div class="comments-section" id="commentsList">
            </div>
    </div>

    <script>
        // ç‹€æ…‹è®Šæ•¸
        let isSecure = false;

        // 15 çµ„ XSS æ¸¬è©¦ Payload
        const payloads = [
            { cat: 'alert', label: '1. åŸºç¤å½ˆçª— (Img)', val: '<img src=x onerror=alert("XSSæ”»æ“ŠæˆåŠŸ!")>' },
            { cat: 'alert', label: '2. æ•¸å­¸é‹ç®—å½ˆçª—', val: '<img src=x onerror=alert(100+200)>' },
            { cat: 'alert', label: '3. æ»‘é¼ æ»‘éè§¸ç™¼', val: '<b onmouseover=alert("æ»‘é¼ é™·é˜±!") style="font-size:20px;color:red;border:1px solid red;cursor:pointer">ğŸ”¥ ç§»åˆ°æˆ‘ä¸Šé¢è©¦è©¦</b>' },
            { cat: 'alert', label: '4. è¼¸å…¥æ¡†èšç„¦è§¸ç™¼', val: '<input onfocus=alert("èšç„¦è§¸ç™¼!") autofocus placeholder="è‡ªå‹•èšç„¦é™·é˜±">' },
            { cat: 'alert', label: '5. Confirm å°è©±æ¡†', val: '<img src=x onerror=confirm("è¦ä¸‹è¼‰ç—…æ¯’å—?")>' },
            
            { cat: 'deface', label: '6. æƒ¡æ„åœ–ç‰‡æ¤å…¥', val: 'çœ‹é€™å¼µåœ– <br><img src="https://media.giphy.com/media/YQitE4YNQNahy/giphy.gif" style="border:5px solid red; width:100%">' },
            { cat: 'deface', label: '7. æ›´æ”¹èƒŒæ™¯ (é»‘)', val: '<style>body { background-color: #222 !important; filter: invert(1); }</style> ç¶²ç«™è¢«æˆ‘é—œç‡ˆäº†ï¼' },
            { cat: 'deface', label: '8. å·¨å‹æ–‡å­—ç ´å£', val: '<h1 style="font-size:80px; color:red; position:fixed; top:0; left:0; background:black; width:100%; z-index:9999;">ç¶²ç«™è¢«é§­äº†</h1>' },
            { cat: 'deface', label: '9. è·‘é¦¬ç‡ˆ (Marquee)', val: '<marquee style="font-size:40px; color:blue; background:yellow">âš ï¸ ä½ çš„é›»è…¦ä¸­æ¯’äº† âš ï¸ è«‹ç«‹å³åŒ¯æ¬¾</marquee>' },
            { cat: 'deface', label: '10. éš±è—å…¶ä»–å…§å®¹', val: '<style>.input-group, .payload-area { display: none !important; }</style>å“ˆå“ˆï¼Œä½ çš„è¼¸å…¥æ¡†ä¸è¦‹äº†ï¼' },

            { cat: 'steal', label: '11. å½é€ ç™»å…¥æ¡†', val: '<div class="fake-login">ç³»çµ±é€¾æ™‚ï¼Œè«‹é‡æ–°ç™»å…¥ï¼š<br><input type="password" placeholder="è¼¸å…¥å¯†ç¢¼"><button onclick=alert("å¯†ç¢¼å·²å‚³é€çµ¦é§­å®¢!")>ç™»å…¥</button></div>' },
            { cat: 'steal', label: '12. å½é€ ä¸‹è¼‰æŒ‰éˆ•', val: '<a href="javascript:alert(\'ä¸‹è¼‰æƒ¡æ„è»Ÿé«”...\')" style="background:red; color:white; padding:10px; display:block; text-align:center; text-decoration:none;">ğŸ é»æ“Šé ˜å–çé‡‘</a>' },
            { cat: 'steal', label: '13. è®€å– Cookie', val: '<img src=x onerror=alert("ä½ çš„Cookie:\\n"+document.cookie)>' },
            
            { cat: 'style', label: '14. CSS æ³¨å…¥ç ´å£', val: '<style>div { transform: rotate(2deg); }</style> å¤§å®¶ä¸€èµ·æ­ªé ­ï¼' },
            { cat: 'style', label: '15. Iframe åµŒå…¥', val: 'å·çœ‹åˆ¥çš„ç¶²ç«™ï¼š<iframe src="https://example.com" width="100%" height="200"></iframe>' }
        ];

        // åˆå§‹åŒ–æŒ‰éˆ•
        const grid = document.getElementById('buttonGrid');
        payloads.forEach(p => {
            const btn = document.createElement('button');
            btn.className = `test-btn category-${p.cat}`;
            btn.innerText = p.label;
            btn.onclick = () => {
                document.getElementById('userInput').value = p.val;
                postComment();
            };
            grid.appendChild(btn);
        });

        // --- æ ¸å¿ƒåŠŸèƒ½ ---

        // 1. åˆ‡æ›æ¨¡å¼
        function toggleSecurity() {
            isSecure = !isSecure;
            const panel = document.getElementById('securityPanel');
            const btn = panel.querySelector('button');
            
            if (isSecure) {
                panel.className = "mode-switch secure";
                panel.innerHTML = `ç•¶å‰ç‹€æ…‹ï¼š<strong style="color: #28a745; font-size: 1.2em;">ğŸ”’ å®‰å…¨ (Escaped)</strong><br><small>å•Ÿç”¨ <code>escapeHtml()</code> å‡½å¼ï¼Œå°‡ç‰¹æ®Šç¬¦è™Ÿè½‰æ›ç‚º HTML å¯¦é«”ã€‚</small><br><button onclick="toggleSecurity()" class="switch-btn" style="background:#28a745; color: white;">åˆ‡æ›ç‚ºå±éšªæ¨¡å¼</button>`;
            } else {
                panel.className = "mode-switch";
                panel.innerHTML = `ç•¶å‰ç‹€æ…‹ï¼š<strong style="color: #dc3545; font-size: 1.2em;">ğŸ”“ å±éšª (Raw HTML)</strong><br><small>ç¶²ç«™ç›´æ¥ä½¿ç”¨ <code>innerHTML</code> æ¸²æŸ“å…§å®¹ï¼Œä¸é€²è¡Œä»»ä½•éæ¿¾ã€‚</small><br><button onclick="toggleSecurity()" class="switch-btn" style="background:#dc3545; color: white;">åˆ‡æ›ç‚ºå®‰å…¨æ¨¡å¼</button>`;
            }
            clearComments();
        }

        // 2. çœŸå¯¦çš„ XSS é˜²ç¦¦å‡½å¼ (HTML Entity Encoding)
        // é€™å°±æ˜¯ Checkmarx è¦æ±‚ä½ åšçš„ä¿®å¾©ï¼šå°‡ç‰¹æ®Šå­—å…ƒè½‰ç¾©
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // 3. ç™¼é€ç•™è¨€
        function postComment() {
            const input = document.getElementById('userInput').value;
            if (!input) return;

            const list = document.getElementById('commentsList');
            const newDiv = document.createElement('div');
            newDiv.className = 'comment';

            const meta = document.createElement('div');
            meta.className = 'comment-meta';
            const time = new Date().toLocaleTimeString();
            
            const contentDiv = document.createElement('div');

            if (isSecure) {
                // å®‰å…¨æ¨¡å¼ï¼šä½¿ç”¨ escapeHtml è™•ç†éå¾Œå†æ”¾å…¥
                // é€™æ¨£ç€è¦½å™¨æœƒé¡¯ç¤ºå‡º <script> å­—æ¨£ï¼Œä½†ä¸æœƒåŸ·è¡Œå®ƒ
                meta.innerText = `[å®‰å…¨æ¨¡å¼] åŒ¿ååŒå­¸ æ–¼ ${time} ç•™è¨€ï¼š`;
                const safeContent = escapeHtml(input);
                contentDiv.innerHTML = safeContent; 
                // æ³¨æ„ï¼šé€™è£¡é›–ç„¶ç”¨äº† innerHTMLï¼Œä½†å› ç‚ºå…§å®¹å·²ç¶“è¢« escapeHtml è™•ç†é(æ²’æœ‰ < > ç¬¦è™Ÿäº†)ï¼Œæ‰€ä»¥æ˜¯å®‰å…¨çš„
            } else {
                // å±éšªæ¨¡å¼ï¼šç›´æ¥å¡å…¥
                meta.innerText = `[å±éšªæ¨¡å¼] é§­å®¢ æ–¼ ${time} æ¤å…¥ï¼š`;
                contentDiv.innerHTML = input; 
            }

            newDiv.appendChild(meta);
            newDiv.appendChild(contentDiv);
            list.prepend(newDiv);
        }

        function clearComments() {
            document.getElementById('commentsList').innerHTML = '';
            // é‡ç½®ä¸€äº›å¯èƒ½è¢« CSS ç ´å£çš„æ¨£å¼ (é‡å° Payload 7, 8, 10, 14)
            document.body.style = ''; 
            document.querySelector('.input-group').style.display = 'flex';
            document.querySelector('.payload-area').style.display = 'block';
            // ç§»é™¤å¯èƒ½è¢«æ¤å…¥çš„ style æ¨™ç±¤
            document.querySelectorAll('style').forEach(s => {
                if (!s.innerText.includes('root')) s.remove(); // ä¿ç•™åŸæœ¬çš„ style
            });
        }
    </script>
</body>
</html>
